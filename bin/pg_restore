#!/bin/bash

set -e

CLUSTERARG=""
CLUSTERSUFFIX=""

if [ "${1}"x = "--virtual"x ]; then
    if [ "${2}"x != "default"x ]; then
        CLUSTERSUFFIX=-"${2}"
    fi
    shift
    shift
fi

PROGRAM=pg_restore
PATHS=("/usr/lib/postgresql/" "/usr/pgsql-")
PATHSUFIX="/bin/pg_restore"
SUPPORTEDVERSIONS=( "10" "9.6" "9.5" "9.4" "9.3" "9.2" "9.1" "9.0" "8.4" "8.3" "8.2" )
for ver in "${SUPPORTEDVERSIONS[@]}"
do
    for PATHPREFIX in "${PATHS[@]}"
    do
        if [ -x $PATHPREFIX$ver$PATHSUFIX ]; then 
    	        PROGRAM=$PATHPREFIX$ver$PATHSUFIX
    	        break 2;
        fi
    done
done

if [ -x /bin/nice ]; then
    NICE=/bin/nice
else 
    NICE=/usr/bin/nice
fi

$NICE $PROGRAM "$@"
